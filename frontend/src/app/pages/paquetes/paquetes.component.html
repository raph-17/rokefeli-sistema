<app-header></app-header>

<div class="paquetes-header">
  <h1>Productos Disponibles</h1> <div class="acciones">
    <button class="btn-avanzada" (click)="toggleBusquedaAvanzada()">
      {{ busquedaAvanzadaActiva ? 'Ocultar Filtros' : 'B√∫squeda avanzada' }}
    </button>
  </div>
</div>

<main class="paquetes-container">

  <aside class="sidebar" *ngIf="busquedaAvanzadaActiva || true"> <h3>Precios:</h3>
    <div class="precio-slider">
      <input type="number" [(ngModel)]="precioMin" placeholder="Min">
      <input type="number" [(ngModel)]="precioMax" placeholder="Max">
    </div>

    <input type="range" min="0" max="200" [(ngModel)]="precioMin">
    <input type="range" min="0" max="200" [(ngModel)]="precioMax">
    <p>S/. {{precioMin}} ‚Äî S/. {{precioMax}}</p>

    <h3>Rese√±as:</h3>
    <div class="stars-filter">
      <div 
        *ngFor="let s of [5,4,3,2,1]" 
        class="stars-row"
        (click)="setResena(s)"
        [class.selected]="resenaSeleccionada === s"
      >
        <span *ngFor="let star of [].constructor(s)">‚≠ê</span>
        <span *ngFor="let empty of [].constructor(5 - s)">‚òÜ</span>
      </div>
      <div class="stars-row" (click)="setResena(0)" *ngIf="resenaSeleccionada > 0">
        <small>Ver todos</small>
      </div>
    </div>
  </aside>

  <section class="lista-paquetes">

    <div *ngIf="cargando" style="width:100%; text-align:center; padding: 40px;">
      <p>Cargando productos...</p>
    </div>

    <div class="paquete-card" *ngFor="let p of paquetesFiltrados">
      <img [src]="p.img" [alt]="p.nombre" onerror="this.onerror=null; this.src='/img/placeholder.png'">
      
      <div class="card-body">
        <h4>{{ p.nombre }}</h4>
        <p class="precio">S/ {{ p.precio | number:'1.2-2' }}</p>
        
        <div class="rating">
          <span *ngFor="let _ of [].constructor(p.stars)">‚≠ê</span>
          <span *ngFor="let _ of [].constructor(5 - p.stars)" style="color:#ccc;">‚òÜ</span>
        </div>

        <button mat-flat-button class="btn-carrito" 
                (click)="agregarAlCarrito(p)" 
                [disabled]="agregandoId === p.id">
          <span *ngIf="agregandoId !== p.id">A√±adir al carrito üõí</span>
          <span *ngIf="agregandoId === p.id">Agregando... ‚è≥</span>
        </button>
      </div>
    </div>

    <div *ngIf="!cargando && paquetesFiltrados.length === 0" style="width:100%; text-align:center;">
      <p>No se encontraron productos con estos filtros üêù</p>
    </div>

    <div class="pagination" *ngIf="paginas.length > 1">
      <span (click)="prevPage()" [class.disabled]="paginaActual === 1">‚Üê</span>
      
      <span *ngFor="let n of paginas" 
            [class.active]="n === paginaActual"
            (click)="setPagina(n)">
        {{ n }}
      </span>
      
      <span (click)="nextPage()" [class.disabled]="paginaActual === paginas.length">‚Üí</span>
    </div>

  </section>

</main>

<app-footer></app-footer>