<div class="paquetes-header">
  <h1>Nuestros Productos</h1>

  <div class="search-bar">
    <input
      type="text"
      placeholder="Â¿QuÃ© estÃ¡s buscando? (ej. Miel, Polen...)"
      [(ngModel)]="filtroNombre"
      (keyup.enter)="buscar()"
    />
    <button (click)="buscar()">ğŸ”</button>
  </div>
</div>

<main class="paquetes-container">
  <aside class="sidebar">
    <h3>CategorÃ­as</h3>
    <div class="categorias-list">
      <div
        class="cat-item"
        [class.active]="filtroCategoria === null"
        (click)="filtrarPorCategoria(null)"
      >
        Todas
      </div>

      <div
        class="cat-item"
        *ngFor="let cat of categorias"
        [class.active]="filtroCategoria === cat.id"
        (click)="filtrarPorCategoria(cat.id)"
      >
        {{ cat.nombre }}
      </div>
    </div>
  </aside>

  <section class="lista-paquetes">
    <div *ngIf="cargando" class="loading-overlay">
      <div class="spinner"></div>
    </div>

    <div class="paquete-card" *ngFor="let p of paquetesFiltrados; trackBy: trackById">
      <div class="img-wrapper">
        <img
          [src]="p.img"
          [alt]="p.nombre"
          onerror="this.onerror=null; this.src='/img/placeholder.png'"
        />
      </div>

      <div class="card-body">
        <h4>{{ p.nombre }}</h4>
        <p class="precio">S/ {{ p.precio | number : '1.2-2' }}</p>

        <p *ngIf="p.descripcion" class="desc">{{ p.descripcion.substring(0, 60) }}</p>

        <button
          mat-flat-button
          class="btn-carrito"
          (click)="agregarAlCarrito(p)"
          [disabled]="agregandoId === p.id"
        >
          <span *ngIf="agregandoId !== p.id">AÃ±adir al carrito</span>
          <span *ngIf="agregandoId === p.id">Agregando...</span>
        </button>
      </div>
    </div>

    <div *ngIf="!cargando && paquetes.length === 0" class="full-width-msg">
      <p>No se encontraron productos con esos filtros ğŸ</p>
    </div>
  </section>
</main>
