<div class="cart-wrapper">
  <div class="cart-header">
    <h1>Tu Carrito de Compras ğŸ›’</h1>
    <button *ngIf="carrito?.detalles?.length" class="btn-clear" (click)="vaciar()">
      Vaciar Carrito
    </button>
  </div>

  <div class="loading-overlay" [class.is-loading]="cargando">
    <div class="spinner"></div>
  </div>

  <div *ngIf="!cargando && (!carrito || carrito?.detalles?.length === 0)" class="empty-cart">
    <div class="empty-content">
      <span style="font-size: 4rem">ğŸ›ï¸</span>
      <h2>Tu carrito estÃ¡ vacÃ­o</h2>
      <p>Â¡Nuestras abejas han preparado cosas deliciosas para ti!</p>
      <a routerLink="/catalogo" class="btn-primary">Ir al CatÃ¡logo</a>
    </div>
  </div>

  <div class="cart-grid" *ngIf="carrito?.detalles?.length > 0">
    <div class="cart-items">
      <div class="item-card" *ngFor="let item of carrito.detalles">
        <div class="item-img">
          <img
            [src]="item.imagenUrl || '/img/placeholder.png'"
            alt="Producto"
            onerror="this.src='/img/placeholder.png'"
          />
        </div>

        <div class="item-info">
          <h3>{{ item.nombreProducto || 'âš ï¸ NOMBRE NULL EN BACKEND' }}</h3>

          <p class="unit-price">Precio unitario: S/ {{ item.precioUnitario | number : '1.2-2' }}</p>
        </div>

        <div class="item-quantity">
          <button
            class="qty-btn"
            (click)="cambiarCantidad(item, -1)"
            [disabled]="item.cantidad <= 1"
          >
            -
          </button>
          <span class="qty-val">{{ item.cantidad }}</span>
          <button class="qty-btn" (click)="cambiarCantidad(item, 1)">+</button>
        </div>

        <div class="item-total">
          <span
            >S/ {{ item.subtotal || item.cantidad * item.precioUnitario | number : '1.2-2' }}</span
          >
        </div>

        <button class="btn-delete" (click)="eliminarItem(item.idProducto)" title="Eliminar">
          ğŸ—‘ï¸
        </button>
      </div>
    </div>

    <div class="cart-summary">
      <div class="summary-card">
        <h2>Resumen del Pedido</h2>

        <div class="summary-row">
          <span>Subtotal</span>
          <span>S/ {{ totalCalculado | number : '1.2-2' }}</span>
        </div>

        <div class="summary-row">
          <span>EnvÃ­o estimado</span>
          <span class="text-success">Por calcular</span>
        </div>

        <hr />

        <div class="summary-row total">
          <span>Total</span>
          <span>S/ {{ totalCalculado | number : '1.2-2' }}</span>
        </div>

        <button class="btn-checkout" (click)="irAPagar()" [disabled]="totalCalculado === 0">
          Proceder al Pago
        </button>

        <a routerLink="/catalogo" class="link-continue">Seguir comprando</a>
      </div>
    </div>
  </div>
</div>
