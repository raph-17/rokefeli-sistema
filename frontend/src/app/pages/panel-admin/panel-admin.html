<app-header-admin></app-header-admin>

<main>
  <div class="dashboard-container">

    <!-- M√©tricas superiores -->
    <div class="metrics">
      <div class="card">
        <h3>Productos</h3>
        <span class="value">{{ products.length || 0 }}</span>
      </div>

      <div class="card">
        <h3>Stock Bajo</h3>
        <span class="value">{{ stockBajo || 0 }}</span>
      </div>

      <div class="card">
        <h3>Ventas Totales</h3>
        <span class="value">{{ ventasTotales || 0 }}</span>
      </div>

      <div class="card">
        <h3>Ingresos</h3>
        <span class="value">S/ {{ ingresosTotales || 0 }}</span>
      </div>
    </div>


    <!-- Tabs -->
    <div class="tabs">
      <button class="tab" 
              [class.active]="activeTab === 'productos'"
              (click)="cambiarTab('productos')">
        Productos
      </button>

      <button class="tab" 
              [class.active]="activeTab === 'inventario'"
              (click)="cambiarTab('inventario')">
        Inventario
      </button>

      <button class="tab" 
              [class.active]="activeTab === 'ventas'"
              (click)="cambiarTab('ventas')">
        Ventas
      </button>
    </div>


    <!-- TAB 1: Productos -->
    <div *ngIf="activeTab === 'productos'" class="table-section">
      <div class="table-header">
        <h3>Gesti√≥n de Productos</h3>

        <button class="btn add" (click)="abrirModalAgregarProducto()">+ Nuevo Producto</button>
      </div>

      <table class="products-table">
        <thead>
          <tr>
            <th>Imagen</th>
            <th>Producto</th>
            <th>Categor√≠a</th>
            <th>Precio</th>
            <th>Stock</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let p of products">
            <td>
              <img [src]="p.imagenUrl" alt="img" width="60" style="border-radius:6px;">
            </td>

            <td>{{ p.nombre }}</td>
            <td>{{ p.categoria.nombre }}</td>

            <td>S/ {{ p.precio }}</td>
            <td>{{ p.stockActual }}</td>

            <td>
              <span class="status" [ngClass]="p.estado === 'ACTIVO' ? 'normal' : 'low'">
                {{ p.estado }}
              </span>
            </td>

            <td class="actions">
              <button class="edit"
                      *ngIf="p.estado === 'ACTIVO'"
                      (click)="desactivarProducto(p.id)">
                üîí Desactivar
              </button>

              <button class="edit"
                      *ngIf="p.estado !== 'ACTIVO'"
                      (click)="activarProducto(p.id)">
                üîì Activar
              </button>

              <button class="delete" (click)="eliminarProducto(p.id)">
                üóëÔ∏è Eliminar
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>



    <!-- TAB 2: Inventario -->
    <div *ngIf="activeTab === 'inventario'" class="table-section">
      <div class="table-header">
        <h3>Inventario</h3>
      </div>

      <table class="products-table">
        <thead>
          <tr>
            <th>Producto</th>
            <th>Stock Actual</th>
            <th>Stock M√≠nimo</th>
            <th>Estado</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let p of products">
            <td>{{ p.nombre }}</td>
            <td>{{ p.stockActual }}</td>
            <td>{{ p.stockMinimo }}</td>

            <td>
              <span class="status" 
                    [ngClass]="p.stockActual < p.stockMinimo ? 'low' : 'normal'">
                {{ p.stockActual < p.stockMinimo ? 'Stock Bajo' : 'Normal' }}
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>



    <!-- TAB 3: Ventas -->
    <div *ngIf="activeTab === 'ventas'" class="table-section">
      <div class="table-header">
        <h3>Ventas Realizadas</h3>
      </div>

      <table class="products-table">
        <thead>
          <tr>
            <th>Producto</th>
            <th>Cantidad</th>
            <th>Total</th>
            <th>Fecha</th>
          </tr>
        </thead>

        <tbody>
          <!-- Usamos ventas || [] para evitar errores -->
          <tr *ngFor="let v of (ventas || [])">
            <td>{{ v.producto }}</td>
            <td>{{ v.cantidad }}</td>
            <td>S/ {{ v.total }}</td>
            <td>{{ v.fecha }}</td>
          </tr>
        </tbody>
      </table>
    </div>

  </div>
  
</main>
<div class="modal-overlay" *ngIf="mostrarModal">
  <div class="modal-container">

    <h2 class="modal-title">Nuevo Producto</h2>

    <form [formGroup]="formProducto" class="modal-form">

      <div class="form-group">
        <label>Nombre:</label>
        <input formControlName="nombre" type="text">
      </div>

      <div class="form-group">
        <label>Descripci√≥n:</label>
        <textarea formControlName="descripcion" rows="2"></textarea>
      </div>

      <div class="form-row">
        <div class="form-group small">
          <label>Precio:</label>
          <input formControlName="precio" type="number">
        </div>

        <div class="form-group small">
          <label>Precio Interno:</label>
          <input formControlName="precioInterno" type="number">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group small">
          <label>Stock Actual:</label>
          <input formControlName="stockActual" type="number">
        </div>

        <div class="form-group small">
          <label>Stock M√≠nimo:</label>
          <input formControlName="stockMinimo" type="number">
        </div>
      </div>

      <div class="form-group">
        <label>URL Imagen:</label>
        <input formControlName="imagenUrl" type="text">
      </div>

    </form>

    <div class="modal-actions">
      <button class="btn cancel" (click)="cerrarModal()">Cancelar</button>
      <button class="btn save" (click)="agregarProducto()">Guardar</button>
    </div>

  </div>
</div>